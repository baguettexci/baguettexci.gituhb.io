---
title: Predicting Fare on NYC Taxi
date: 2018-10-28
tags: 
  - machine learning
  - data science
header:
  image: ""
excerpt: "Machine Learning, Data Science"
mathjax: "true"
---



## 1) Setup
### Load packages
```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
```

### Load & Viewing the Data
```python
pd.set_option('display.float_format', lambda x: '%.3f' % x)
nyc = pd.read_csv("C:/Users/Weasel/Desktop/NYC Taxi/train.csv", nrows = 3_000_000, parse_dates = ['pickup_datetime']).drop(columns = 'key')
nyc.head()
```
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fare_amount</th>
      <th>pickup_datetime</th>
      <th>pickup_longitude</th>
      <th>pickup_latitude</th>
      <th>dropoff_longitude</th>
      <th>dropoff_latitude</th>
      <th>passenger_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.500</td>
      <td>2009-06-15 17:26:21</td>
      <td>-73.844</td>
      <td>40.721</td>
      <td>-73.842</td>
      <td>40.712</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>16.900</td>
      <td>2010-01-05 16:52:16</td>
      <td>-74.016</td>
      <td>40.711</td>
      <td>-73.979</td>
      <td>40.782</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5.700</td>
      <td>2011-08-18 00:35:00</td>
      <td>-73.983</td>
      <td>40.761</td>
      <td>-73.991</td>
      <td>40.751</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7.700</td>
      <td>2012-04-21 04:30:42</td>
      <td>-73.987</td>
      <td>40.733</td>
      <td>-73.992</td>
      <td>40.758</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.300</td>
      <td>2010-03-09 07:51:00</td>
      <td>-73.968</td>
      <td>40.768</td>
      <td>-73.957</td>
      <td>40.784</td>
      <td>1</td>
    </tr>
  </tbody>
</table>

## 2) Data Preprocessing
### View the types of data in the dataset
```python
nyc.dtypes
```
{% highlight text %}
fare_amount                 float64
pickup_datetime      datetime64[ns]
pickup_longitude            float64
pickup_latitude             float64
dropoff_longitude           float64
dropoff_latitude            float64
passenger_count               int64
dtype: object
{% endhighlight %} 

### Check for missing values in the dataset
```python
nyc.isnull().sum()
```
{% highlight text %}
fare_amount           0
pickup_datetime       0
pickup_longitude      0
pickup_latitude       0
dropoff_longitude    23
dropoff_latitude     23
passenger_count       0
dtype: int64
{% endhighlight %} 

### Drop the nan columns
```python
nyc = nyc.dropna()
# Checking missing value
nyc.isnull().sum()
```
{% highlight text %}
fare_amount          0
pickup_datetime      0
pickup_longitude     0
pickup_latitude      0
dropoff_longitude    0
dropoff_latitude     0
passenger_count      0
dtype: int64
{% endhighlight %} 

### Feature Extraction
#### 1) Haversine distance
##### 1) Haversine distance
```python
def haversine(lon1, lat1, lon2, lat2):
    """
    Calculate the great circle distance between two points
    on the earth (specified in decimal degrees)

    All args must be of equal length.    

    """
    lon1, lat1, lon2, lat2 = map(np.radians, [lon1, lat1, lon2, lat2])

    dlon = lon2 - lon1
    dlat = lat2 - lat1

    a = np.sin(dlat/2.0)**2 + np.cos(lat1) * np.cos(lat2) * np.sin(dlon/2.0)**2

    c = 2 * np.arcsin(np.sqrt(a))
    #average radii are about 6,371 kilometres (3,959 mi).
    km = 6371 * c  # 6371 is Radius of earth in kilometers. Use 3956 for miles
    return km
```

#### Apply the haversine function and view the dataset
```python
nyc['distance'] = haversine(nyc['pickup_latitude'], nyc['pickup_longitude'], nyc['dropoff_latitude'] , nyc['dropoff_longitude'])
nyc.head()
```
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fare_amount</th>
      <th>pickup_datetime</th>
      <th>pickup_longitude</th>
      <th>pickup_latitude</th>
      <th>dropoff_longitude</th>
      <th>dropoff_latitude</th>
      <th>passenger_count</th>
      <th>distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.500</td>
      <td>2009-06-15 17:26:21</td>
      <td>-73.844</td>
      <td>40.721</td>
      <td>-73.842</td>
      <td>40.712</td>
      <td>1</td>
      <td>0.410</td>
    </tr>
    <tr>
      <th>1</th>
      <td>16.900</td>
      <td>2010-01-05 16:52:16</td>
      <td>-74.016</td>
      <td>40.711</td>
      <td>-73.979</td>
      <td>40.782</td>
      <td>1</td>
      <td>4.629</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5.700</td>
      <td>2011-08-18 00:35:00</td>
      <td>-73.983</td>
      <td>40.761</td>
      <td>-73.991</td>
      <td>40.751</td>
      <td>2</td>
      <td>1.001</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7.700</td>
      <td>2012-04-21 04:30:42</td>
      <td>-73.987</td>
      <td>40.733</td>
      <td>-73.992</td>
      <td>40.758</td>
      <td>1</td>
      <td>0.910</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.300</td>
      <td>2010-03-09 07:51:00</td>
      <td>-73.968</td>
      <td>40.768</td>
      <td>-73.957</td>
      <td>40.784</td>
      <td>1</td>
      <td>1.361</td>
    </tr>
  </tbody>
</table>

#### 2) Datetime (year, month, day, day of the week, hour)
```python

```


## 3) Exploratory data analysis
### View the shape of the dataset



<img src="{{ site.url }}{{ site.baseurl }}/images/NYC Taxi/.png" alt="">
```python

```
{% highlight text %}

{% endhighlight %} 
